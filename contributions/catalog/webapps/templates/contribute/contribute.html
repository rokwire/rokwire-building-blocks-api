<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <title> Capability Catalog </title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link rel="stylesheet" href="https://use.typekit.net/qjr3liq.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/bar.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='js/modernizr.js') }}" rel="javascript">
    <script src="../../static/js/modernizr.js"></script> <!-- Modernizr -->
    <link href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <style>
        .navbar a:hover, .dropdown:hover .dropbtn, .dropbtn:focus {
            background-color: #2a4b45;
        }

        .dropdown-content {
            display: none;
            position: relative;
            background-color: #2a4b45;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            /*z-index: 1;*/
            cursor: pointer;
        }

        .dropdown-content a {
            float: right;
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            padding-right: 50px;
            padding-left: 50px;
            text-align: right;
            cursor: pointer;
        }

        .dropdown-content a:hover {
            background-color: #f4f7f5;
            border: grey;
            border-radius: 5%;
        }
        #sourceurl{
            display:none;
        }

    </style>
</head>
<script>
    var capability_count = 0;
    var talent_count = 0;
    var contributor_count = 0;
</script>
{% if post.capabilities %}
    <script>is_cap_edting = true;</script>
{% endif %}
{% if post.talents %}
    <script>is_tal_edting = true;</script>
{% endif %}
<body>
    <div class="container-fluid">

        {% include 'topnav.html' %}

        <div>
            <nav>
                <ol class="cd-multi-steps text-top">
                    <li class="current"><a href="#contribute">Contribution Details</a></li>
                    <li><em><a href="#capability-parent">Capability / Talent Details </a></em></li>
                    <li><em><a href="#contact">Contact Details</a></em></li>
                    <li><em><a href="#submit">Submit</a></em></li>
                </ol>
            </nav>
        </div>

        <form enctype=multipart/form-data class="form-horizontal" method="POST" onsubmit="return data_validation()">

            <div class="container">
                <h2 id="contribute">Contribution Details</h2>
                <div class="form-group">
                    <div>
                        <input id="contribution_details" name="contribution_details" type="hidden" value="contribution">
                    </div>
                </div>
                {% if is_editable %}
                    <input class="form-control" type="hidden" name="contribution_id" value={{ post.id }} >
                {% endif %}

                <div class="form-group">
                    <label class="required control-label col-sm-2">Contribution Name</label>
                    <div class="col-sm-10" id="contribution_name_div">
                        {% if is_editable %}
                            <input class="form-control" id="contribution_name" name="contribution_name"
                                   placeholder="Give a name for your contribution"
                                   value="{{ post | filter_nested_dict(["name"]) }}" type="text">
                        {% else %}
                            <input class="form-control" id="contribution_name" name="contribution_name"
                                   placeholder="Give a name for your contribution" type="text">
                        {% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label class="required control-label col-sm-2">Short Description</label>
                    <div class="col-sm-10">
                        {% if is_editable %}
                            <input class="form-control" id="contribution_description" name="contribution_shortDescription"
                                   placeholder="Give a short description"
                                   value="{{ post | filter_nested_dict(["shortDescription"]) }}" type="text">
                        {% else %}
                            <input class="form-control" id="contribution_description" name="contribution_shortDescription"
                                   placeholder="Give a short description" type="text">
                        {% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-sm-2">Long Description</label>
                    <div class="col-sm-10">
                        {% if is_editable %}
                            <textarea id="contribution_detail" name="contribution_longDescription"
                                      placeholder="Give a detailed description"
                                      style="height:150px">{{ post | filter_nested_dict(["longDescription"]) }}</textarea>
                        {% else %}
                            <textarea id="contribution_detail" name="contribution_longDescription"
                                      placeholder="Give a detailed description"
                                      style="height:150px"></textarea>
                        {% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-sm-2">Contribution Admins</label>
                    <div class="col-sm-10">
                        {% if is_editable %}
                            <input class="form-control" id="contribution_Admins"
                                   name="contribution_contributionAdmins"
                                   placeholder="Give a list of github usernames, separated by comma, to be selected as admins"
                                   type="text" value="{{ post.contributionAdmins|join(', ') }}">
                        {% else %}
                            <input class="form-control" id="contribution_Admins"
                                   name="contribution_contributionAdmins"
                                   placeholder="Give a list of github usernames, separated by comma, to be selected as admins"
                                   type="text">
                        {% endif %}
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-sm-2">Contributor Details</label>
                    <div class="col-sm-10">
                        <button class="button button2" id="add-contributor-person">Add Person</button>
                        <button class="button button2" id="add-contributor-org">Add Organization</button>
                    </div>
                </div>
            </div> {# end of contribution-details container div #}

            <!-------------- contributor block parent -------------------------->
            <div class="container">
                <div id="contributor-parent">
                    <!-------------------- organization block clean -------------------->
                    <div id="organization-clean" style="display: none">
                        <hr class="dotted">
                        <h3 id="capability">Add an Organization to this Contribution</h3>
                        <div class="form-group">
                            <div>
                                <input id="contributor_type" name="contributor_type" type="hidden" value="organization">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="org_name" name="org_name" placeholder="Give organization name" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Address</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="org_address" name="org_address" placeholder="Give organization address" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Email</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="org_email" name="org_email" placeholder="Give organization email" type="email">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Phone</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="org_phone" name="org_phone" placeholder="Give organization phone number" type="tel" minlength="9" maxlength="14">
                            </div>
                        </div>
                    </div> <!--- end of organization block clean -->

                    <!-------------------- person block clean -------------------->
                    <div id="person-clean" style="display: none">
                        <hr class="dotted">
                        <h3 id="capability">Add a Person to this Contribution</h3>
                        <div class="form-group">
                            <div>
                                <input id="contributor_type" name="contributor_type" type="hidden" value="person">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">First Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contributor_fname" name="person_firstName" placeholder="Give contributor's first name" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Middle Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contributor_mname" name="person_middleName" placeholder="Give contributor's middle name" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Last Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contributor_lname" name="person_lastName" placeholder="Give contributor's last name" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Email</label>
                            <div class="col-sm-10">
                                <input class="form-control" name="person_email" placeholder="Give contributor's email" type="email">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Phone Number</label>
                            <div class="col-sm-10">
                                <input class="form-control" name="person_phone" placeholder="Give contributor's phone number" type="tel" minlength="9" maxlength="14">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Affiliation Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" name="affiliation_name" placeholder="Give contributor's affiliation name" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Affiliation Address</label>
                            <div class="col-sm-10">
                                <input class="form-control" name="affiliation_address" placeholder="Give contributor's affiliation address" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Affiliation Email</label>
                            <div class="col-sm-10">
                                <input class="form-control" name="affiliation_email" placeholder="Give contributor's affiliation email" type="email">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Affiliation Phone</label>
                            <div class="col-sm-10">
                                <input class="form-control" name="affiliation_phone" placeholder="Give contributor's affiliation phone number" type="tel" minlength="9" maxlength="14">
                            </div>
                        </div>
                    </div> <!-- end of person block clean -->

                    {% if post.contributors %}
                        {% for contributor in post.contributors %}
                            {% if contributor["contributorType"] == 'organization' %}
                                <!-------------------- organization block existing records -------------------->
                                <div id="organization-existing-records" style="display: block">
                                    <hr class="dotted">
                                    <h3 id="capability">Add an Organization to this Contribution</h3>
                                    <div class="form-group">
                                        <div>
                                            <input id="contributor_type_{{loop.index0}}"
                                                   name="contributor_type_{{loop.index0}}"
                                                   type="hidden" value="organization">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Name</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" id="org_name_{{loop.index0}}"
                                                       name="org_name_{{loop.index0}}" placeholder=""
                                                       type="text" value="{{ contributor|filter_nested_dict(["name"]) }}">
                                            {% else %}
                                                <input class="form-control" id="org_name_{{loop.index0}}"
                                                       name="org_name_{{loop.index0}}" placeholder="" type="text">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Address</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" id="org_address_{{loop.index0}}"
                                                       name="org_address_{{loop.index0}}" placeholder=""
                                                       type="text" value="{{ contributor|filter_nested_dict(["address"]) }}">
                                            {% else %}
                                                <input class="form-control" id="org_address_{{loop.index0}}"
                                                       name="org_address_{{loop.index0}}" placeholder="" type="text">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Organization Email</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" id="org_email_{{loop.index0}}"
                                                       name="org_email_{{loop.index0}}" placeholder=""
                                                       type="email" value="{{ contributor|filter_nested_dict(["email"]) }}">
                                            {% else %}
                                                <input class="form-control" id="org_email_{{loop.index0}}"
                                                       name="org_email_{{loop.index0}}" placeholder="" type="email">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Organization Phone</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" id="org_phone_{{loop.index0}}"
                                                       name="org_phone_{{loop.index0}}" placeholder=""
                                                       type="tel" value="{{ contributor|filter_nested_dict(["phone"]) }}" minlength="9" maxlength="14">
                                            {% else %}
                                                <input class="form-control" id="org_phone_{{loop.index0}}"
                                                       name="org_phone_{{loop.index0}}" placeholder="" type="tel" minlength="9" maxlength="14">
                                            {% endif %}
                                        </div>
                                    </div>
                                </div> <!-- end of organization existing records -->
                            {% endif %}
                            {% if contributor["contributorType"] == 'person' %}
                                <!-------------------- person block existing records -------------------->
                                <div id="person-existing-records" style="display: block">
                                    <hr class="dotted">
                                    <h3 id="capability">Add a Person to this Contribution</h3>
                                    <div class="form-group">
                                        <div>
                                            <input id="contributor_type_{{loop.index0}}"
                                                   name="contributor_type_{{loop.index0}}" type="hidden" value="person">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Contributor's first name</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" id="contributor_fname_{{loop.index0}}"
                                                       name="person_firstName_{{loop.index0}}" placeholder=""
                                                       type="text" value="{{ contributor | filter_nested_dict(["firstName"]) }}">
                                            {% else %}
                                                <input class="form-control" id="contributor_fname_{{loop.index0}}"
                                                       name="person_firstName_{{loop.index0}}" placeholder="" type="text">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Contributor's middle name</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" id="contributor_mname_{{loop.index0}}"
                                                       name="person_middleName_{{loop.index0}}" placeholder=""
                                                       type="text" value="{{ contributor | filter_nested_dict(["middleName"]) }}">
                                            {% else %}
                                                <input class="form-control" id="contributor_mname_{{loop.index0}}"
                                                       name="person_middleName_{{loop.index0}}" placeholder="" type="text">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Contributor's last name</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" id="contributor_lname_{{loop.index0}}"
                                                       name="person_lastName_{{loop.index0}}" placeholder=""
                                                       type="text" value="{{ contributor | filter_nested_dict(["lastName"]) }}">
                                            {% else %}
                                                <input class="form-control" id="contributor_lname_{{loop.index0}}"
                                                       name="person_lastName_{{loop.index0}}" placeholder="" type="text">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Contributor Email</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" name="person_email_{{loop.index0}}"
                                                       id="person_email_{{loop.index0}}" placeholder=""
                                                       type="email" value="{{ contributor| filter_nested_dict(["email"]) }}">
                                            {% else %}
                                                <input class="form-control" name="person_email_{{loop.index0}}"
                                                       id="person_email_{{loop.index0}}" placeholder="" type="email">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Contributor Phone</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" name="person_phone_{{loop.index0}}"
                                                       id="person_phone_{{loop.index0}}" placeholder=""
                                                       type="tel" value="{{ contributor | filter_nested_dict(["phone"]) }}" minlength="9" maxlength="14">
                                            {% else %}
                                                <input class="form-control" name="person_phone_{{loop.index0}}"
                                                       id="person_phone_{{loop.index0}}" placeholder="" type="tel" minlength="9" maxlength="14">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Affiliation Name</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" name="affiliation_name_{{loop.index0}}"
                                                       id="affiliation_name_{{loop.index0}}" placeholder=""
                                                       type="text" value="{{ contributor | filter_nested_dict(["affiliation", "name"]) }}">
                                            {% else %}
                                                <input class="form-control" name="affiliation_name_{{loop.index0}}"
                                                       id="affiliation_name_{{loop.index0}}" placeholder="" type="text">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Affiliation Address</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" name="affiliation_address_{{loop.index0}}"
                                                       id="affilication_address_{{loop.index0}}"
                                                       placeholder="" type="text"
                                                       value="{{ contributor | filter_nested_dict(["affiliation", "address"]) }}">
                                            {% else %}
                                                <input class="form-control" name="affiliation_address_{{loop.index0}}"
                                                       id="affiliation_address_{{loop.index0}}"
                                                       placeholder="" type="text">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Affiliation Email</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" name="affiliation_email_{{loop.index0}}"
                                                       id="affiliation_email_{{loop.index0}}" placeholder=""
                                                       type="email" value="{{ contributor | filter_nested_dict(["affiliation", "email"]) }}">
                                            {% else %}
                                                <input class="form-control" name="affiliation_email_{{loop.index0}}"
                                                       id="affiliation_email_{{loop.index0}}" placeholder="" type="email">
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Affiliation Phone</label>
                                        <div class="col-sm-10">
                                            {% if is_editable %}
                                                <input class="form-control" name="affiliation_phone_{{loop.index0}}"
                                                       id="affiliation_phone_{{loop.index0}}"
                                                       placeholder="" type="tel" minlength="9" maxlength="14"
                                                       value="{{ contributor | filter_nested_dict(["affiliation", "phone"]) }}">
                                            {% else %}
                                                <input class="form-control" name="affiliation_phone_{{loop.index0}}"
                                                       id="affiliation_phone_{{loop.index0}}"
                                                       placeholder="" type="tel" minlength="9" maxlength="14">
                                            {% endif %}
                                        </div>
                                    </div>
                                </div> <!-- end of person existing records -->
                            {% endif %}
                            <script>contributor_count++;</script>
                        {% endfor %}f
                    {% endif %}
                </div> {# end of contributor block parent div #}
            </div> {# end of contributor block parent container div #}

            <div class="container" id="cd-multi-steps-text-top">
                <nav>
                    <ol class="cd-multi-steps text-top">
                        <li class="visited"><em><a href="#contribute">Contribution Details</a></em></li>
                        <li class="current"><em><a href="#capability-parent">Capability / Talent Details </a></em></li>
                        <li><em><a href="#contact">Contact Details</a></em></li>
                        <li><em><a href="#submit">Submit</a></em></li>
                    </ol>
                </nav>
            </div>

            <div class="container">
                <div class="form-group" id="select-contribution-div">
                    <label class="required control-label col-sm-2" id="select-contribution">Select the Contribution Type</label>
                    <div class="col-sm-10" id="select-contribution-button">
                        <button class="button button2" id="add-capability" onclick="AddCapability(event); MoveSelector(event);">Add a Capability</button>
                        OR
                        <button class="button button2" id="add-talent" onclick="AddTalent(event); MoveSelector(event);">Add a Talent</button>
                    </div>
                </div>
            </div> {# end of select-contribution-div container div #}

            <!-----------------------------------------capability block ------------------------------------>
            <div class="container">
                <div id="capability-parent" style="display: block; background-color:white">

                <!--------------------------- capability clean block --------------------------------->
                <div id="capability-div-clean" style="display: none; background-color:white">
                    <!-- all field id in capability clean block will be appended with _0 -->
                    <hr class="dotted">
                    <button type="button" class="button button3 pull-right delete-capability-btn" id="delete_capability" type="submit" style="margin-top:-15px;">Delete Capability</button>
                    <div id="capability">
                        <h3 id="capability">Add a Capability to this Contribution</h3>
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Capability Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="capability_name" name="capability_name"
                                       placeholder="Give a name for your capability" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Capability Description</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="capability_description" name="capability_description"
                                       placeholder="Give a short description" type="text">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-2" for="capability_icon">Upload an icon</label>
                            <div class="col-sm-10">
                                <input accept="image/*" id="capability_icon" name="capability_icon" type="file">
                            </div>
                        </div>

                        <div class="form-group" id="open-source-check-div">
                            <label class="required control-label col-sm-2"> Is code Open Sourced? </label>
                            <div class="col-sm-10">
                                <!-- open source yes no block -->
                                <label class="form-check-label radio-inline">
                                    <input class="form-check-input" id="open_source_yes"
                                           name="capability_isOpenSource" type="radio" value="y">
                                    Yes
                                </label>
                                <label class="form-check-label radio-inline">
                                    <input class="form-check-input" id="open_source_no"
                                           name="capability_isOpenSource" type="radio" value="n">
                                    No
                                </label>
                            </div>
                        </div>

                        <div class="form-group" id="sourceurl">
                            <label class="control-label col-sm-2">Source repo URL</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="source_url" name="capability_sourceRepoUrl"
                                       placeholder="Source code repository URL (if open sourced)" type="url">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">API Doc URL</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="api_url" name="capability_apiDocUrl"
                                       placeholder="API documentation URL" type="url">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Deployment location</label>
                            <div class="col-sm-10">
                                <label class="form-check-label radio-inline">
                                    <input class="form-check-input" id="deploy_internal" name="deploymentDetails_location"
                                           type="radio" value="internal">
                                    Internal
                                </label>
                                <label class="form-check-label radio-inline">
                                    <input class="form-check-input" id="deploy_external"
                                           name="deploymentDetails_location" type="radio"
                                           value="external">
                                    External
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-2" for="api_base">API Base Location</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="api_base" name="capability_apiBaseUrl"
                                       placeholder="API base URL" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="required control-label col-sm-2" for="docker_img">Docker Image Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="docker_img" name="deploymentDetails_dockerImageName"
                                       placeholder="Docker image name (If internally deployed)" type="text">
                            </div>
                        </div>

                        <div name="add-env-var-div" class="form-group">
                            <label class="control-label col-sm-2">Environment Variable(s)</label>
                            <div class="col-sm-10" id="key-val" style="display: table">
                                <!-- environment variables are appended with env_index and cap_index starting with 0 -->
                                <!-- environment variables match the pattern environmentVariables_key_envindex_capindex -->
                                <input class="form-control envvar-key" name="environmentVariables_key_0" placeholder="Key"
                                       id="environmentVariables_key_0" type="text">
                                <input class="form-control envvar-value" name="environmentVariables_value_0" placeholder="Value"
                                       id="environmentVariables_value_0" type="password">
                                <i class="bi bi-eye-slash field_icon" id="togglePassword"></i>
                                <i class="bi bi-x-lg" id="env-var-close-btn"></i>
                            </div>
                        </div>
                        <div id="add-env-var-div" class="row env-var-div-row">
                            <div class="col-sm-2">
                                <!-- empty column" -->
                            </div>
                            <div class="col-sm-10" id="add-env-var-button-div">
                                <!-- place holder for dynamic button for add environment variables" -->
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="required control-label col-sm-2">Database Detail</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="db-detail" name="deploymentDetails_databaseDetails"
                                       placeholder="Details of API endpoint to delete user info given the user UUID"
                                       type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Version</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="version" name="capability_version"
                                       placeholder="latest version number"
                                       type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Version URL</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="version_url" name="capability_versionUrl"
                                       placeholder=""
                                       type="url">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="required control-label col-sm-2">Health Check URL</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="health" name="capability_healthCheckUrl"
                                       placeholder="health check url" type="url">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="required control-label col-sm-2">Authentication Method</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="auth" name="deploymentDetails_authMethod"
                                       placeholder="" type="text">

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="required control-label col-sm-2">Data Deletion</label>
                            <div class="col-sm-10">
                                <input class="form-control datadel-endpoint" id="datadel_endpoint" name="dataDeletionEndpointDetails_deletionEndpoint"
                                       placeholder="Endpoint" type="text">
                                <input class="form-control datadel-api" id="datadel_api" name="dataDeletionEndpointDetails_apiKey"
                                       placeholder="Api Key" type="password">
                                <i class="bi bi-eye-slash field_icon" id="togglePassword"></i>
                                <br>
                            </div>
                        </div>
                    </div> <!--- end of div id capability --->
                </div> <!--- end of div capability-div-clean --->

                <!--------------------------------- capability block for existing records ------------------------->
                {% if post.capabilities %}
                    {% for capability in post.capabilities %}
                        <div id="capability-div-existing-records" style="display: block; background-color:white">
                            <hr class="dotted">
                            {% if is_editable %}
                                <button type="button" class="button button3 pull-right delete-capability-btn" id="delete_capability_{{loop.index0}}" style="margin-top:-15px;">Delete Capability</button>
                            {% endif %}
                            <div id="capability_{{loop.index0}}">
                                <h3 id="capability_{{loop.index0}}">Capability - {{ capability | filter_nested_dict(["name"]) }}</h3>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Capability Name</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control" id="capability_name_{{loop.index0}}"
                                                   name="capability_name_{{loop.index0}}"
                                                   placeholder="Give a name for your capability"
                                                   type="text" value="{{ capability | filter_nested_dict(["name"]) }}">
                                        {% else %}
                                            <input class="form-control" id="capability_name_{{loop.index0}}"
                                                   name="capability_name_{{loop.index0}}"
                                                   placeholder="Give a name for your capability" type="text">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Capability Description</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control" id="capability_description_{{loop.index0}}"
                                                   name="capability_description_{{loop.index0}}"
                                                   placeholder="Give a short description"
                                                   type="text" value="{{ capability | filter_nested_dict(["description"]) }}">
                                        {% else %}
                                            <input class="form-control" id="capability_description_{{loop.index0}}"
                                                   name="capability_description_{{loop.index0}}"
                                                   placeholder="Give a short description" type="text">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2" for="capability_icon">Upload an icon</label>
                                    <div class="col-sm-10">
                                        <input accept="image/*" id="capability_icon_{{loop.index0}}"
                                               name="capability_icon_{{loop.index0}}" type="file">
                                    </div>
                                </div>
                                <div class="form-group" id="open-source-check-div">
                                    <label class="required control-label col-sm-2">Is code Open Sourced? </label>
                                    <div class="col-sm-10">
                                        <!-- open source yes no block -->
                                        {% if is_editable %}
                                            {% if capability | filter_nested_dict(["isOpenSource"]) == True %}
                                                <label class="form-check-label radio-inline">
                                                    <input class="form-check-input" id="open_source_yes_{{loop.index0}}"
                                                           name="capability_isOpenSource_{{loop.index0}}" type="radio"
                                                           checked="checked" value="y">
                                                    Yes
                                                </label>
                                            {% else %}
                                                <label class="form-check-label radio-inline">
                                                    <input class="form-check-input" id="open_source_yes_{{loop.index0}}"
                                                            name="capability_isOpenSource_{{loop.index0}}"
                                                            type="radio" value="y">
                                                    Yes
                                                </label>
                                            {%  endif %}
                                            {% if capability | filter_nested_dict(["isOpenSource"]) == False %}
                                                <label class="form-check-label radio-inline">
                                                    <input class="form-check-input" id="open_source_no_{{loop.index0}}"
                                                           name="capability_isOpenSource_{{loop.index0}}"
                                                           type="radio" checked="checked" value="n">
                                                    No
                                                </label>
                                            {% else %}
                                                <label class="form-check-label radio-inline">
                                                    <input class="form-check-input" id="open_source_no_{{loop.index0}}"
                                                           name="capability_isOpenSource_{{loop.index0}}"
                                                           type="radio" value="n">
                                                    No
                                                </label>
                                            {%  endif %}
                                        {% else %}
                                            <label class="form-check-label radio-inline">
                                                <input class="form-check-input" id="open_source_yes_{{loop.index0}}"
                                                       name="capability_isOpenSource_{{loop.index0}}"
                                                       type="radio" value="y">
                                                Yes
                                            </label>
                                            <label class="form-check-label radio-inline">
                                                <input class="form-check-input" id="open_source_no_{{loop.index0}}"
                                                       name="capability_isOpenSource_{{loop.index0}}"
                                                       type="radio" value="n">
                                                No
                                            </label>
                                        {% endif %}
                                    </div>
                                </div> <!-- end of open source yes no check div -->
                                <!-- display opensource url if yes -->
                                {% if is_editable %}
                                    {% if capability | filter_nested_dict(["isOpenSource"]) == True %}
                                        <div class="form-group"
                                             id="sourceurl_{{loop.index0}}"
                                             style="display: block;">
                                            <label class="control-label col-sm-2">Source repo URL</label>
                                            <div class="col-sm-10">
                                                <input class="form-control"
                                                       id="source_url_{{loop.index0}}"
                                                       name="capability_sourceRepoUrl_{{loop.index0}}"
                                                       placeholder="Source code repository URL (if open sourced)"
                                                       type="url"
                                                       value="{{ capability | filter_nested_dict(["sourceRepoUrl"]) }}">
                                            </div>
                                        </div>
                                    {%  elif capability | filter_nested_dict(["isOpenSource"]) == False %}
                                        <div class="form-group" id="sourceurl_{{loop.index0}}" style="display: none;">
                                            <label class="control-label col-sm-2">Source repo URL</label>
                                            <div class="col-sm-10">
                                                    <input class="form-control" id="source_url_{{loop.index0}}"
                                                           name="capability_sourceRepoUrl_{{loop.index0}}"
                                                           placeholder="Source code repository URL (if open sourced)"
                                                           type="url"
                                                           value="{{ capability | filter_nested_dict(["sourceRepoUrl"]) }}" >
                                            </div>
                                        </div>
                                    {% endif %}
                                {% else %}
                                    {% if capability | filter_nested_dict(["isOpenSource"]) == True %}
                                        <div class="form-group"
                                             id="sourceurl_{{loop.index0}}"
                                             style="display: block">
                                            <label class="control-label col-sm-2">Source repo URL</label>
                                            <div class="col-sm-10">
                                                <input class="form-control"
                                                       id="source_url_{{loop.index0}}"
                                                       name="capability_sourceRepoUrl_{{loop.index0}}"
                                                       placeholder="Source code repository URL (if open sourced)"
                                                       type="url">
                                            </div>
                                        </div>
                                    {%  elif capability | filter_nested_dict(["isOpenSource"]) == False %}
                                        <div class="form-group" id="sourceurl_{{loop.index0}}" style="display: none">
                                            <label class="control-label col-sm-2">Source repo URL</label>
                                            <div class="col-sm-10">
                                                    <input class="form-control" id="source_url_{{loop.index0}}"
                                                           name="capability_sourceRepoUrl_{{loop.index0}}"
                                                           placeholder="Source code repository URL (if open sourced)"
                                                           type="url" >
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endif %} <!-- end of open source url div -->
                                <div class="form-group">
                                    <label class="control-label col-sm-2">API Doc URL</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control" id="api_url_{{loop.index0}}"
                                                   name="capability_apiDocUrl_{{loop.index0}}"
                                                   placeholder="API documentation URL"
                                                   type="url"
                                                   value="{{ capability | filter_nested_dict(["apiDocUrl"]) }}">
                                        {% else %}
                                            <input class="form-control" id="api_url_{{loop.index0}}"
                                                   name="capability_apiDocUrl_{{loop.index0}}"
                                                   placeholder="API documentation URL" type="url">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Deployment location</label>
                                    <div class="col-sm-10">
                                        <label class="form-check-label radio-inline">
                                            {% if is_editable %}
                                                {% if capability | filter_nested_dict(["deploymentDetails","location"]) == "internal" %}
                                                    <input class="form-check-input" id="deploy_internal_{{loop.index0}}"
                                                           name="deploymentDetails_location_{{loop.index0}}"
                                                           type="radio" value="internal" checked="checked"> Internal
                                                {% else %}
                                                    <input class="form-check-input" id="deploy_internal_{{loop.index0}}"
                                                           name="deploymentDetails_location_{{loop.index0}}"
                                                           type="radio" value="internal"> Internal
                                                {% endif %}
                                            {% else %}
                                                <input class="form-check-input" id="deploy_internal_{{loop.index0}}"
                                                       name="deploymentDetails_location_{{loop.index0}}"
                                                       type="radio" value="internal"> internal
                                            {% endif %}
                                        </label>
                                        <label class="form-check-label radio-inline">
                                            {% if is_editable %}
                                                {% if capability | filter_nested_dict(["deploymentDetails","location"]) == "external" %}
                                                    <input class="form-check-input" id="deploy_external_{{loop.index0}}"
                                                           name="deploymentDetails_location_{{loop.index0}}" type="radio"
                                                           value="external" checked="checked"> External
                                                {% else %}
                                                    <input class="form-check-input" id="deploy_external_{{loop.index0}}"
                                                           name="deploymentDetails_location_{{loop.index0}}" type="radio"
                                                           value="external"> external
                                                {% endif %}
                                            {% else %}
                                                <input class="form-check-input" id="deploy_external_{{loop.index0}}"
                                                       name="deploymentDetails_location_{{loop.index0}}" type="radio"
                                                       value="external"> External
                                            {% endif %}
                                        </label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="control-label col-sm-2" for="api_base">API Base Location</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control" id="api_base_{{loop.index0}}"
                                                   name="capability_apiBaseUrl_{{loop.index0}}"
                                                   placeholder="API base URL"
                                                   type="text"
                                                   value="{{ capability | filter_nested_dict(["apiBaseUrl"]) }}">
                                        {% else %}
                                            <input class="form-control" id="api_base_{{loop.index0}}"
                                                   name="capability_apiBaseUrl_{{loop.index0}}"
                                                   placeholder="API base URL" type="text">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2" for="docker_img">Docker Image Name</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control" id="docker_img_{{loop.index0}}"
                                                   name="deploymentDetails_dockerImageName_{{loop.index0}}"
                                                   placeholder="Docker image name (If internally deployed)"
                                                   type="text"
                                                   value="{{ capability | filter_nested_dict(["deploymentDetails","dockerImageName"]) }}">
                                        {% else %}
                                            <input class="form-control" id="docker_img_{{loop.index0}}"
                                                   name="deploymentDetails_dockerImageName_{{loop.index0}}"
                                                   placeholder="Docker image name (If internally deployed)" type="text">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group" name="add-env-var-div">
                                    <label class="control-label col-sm-2">Environment Variable(s)</label>
                                    <div class="col-sm-10" id="key-val_{{ loop.index0 }}" style="display: table">
                                        {% if capability["deploymentDetails"]["environmentVariables"] %}
                                            <!-- environment variables match the pattern environmentVariables_key_envindex_capindex -->
                                            {% set caploop = loop.index0 %}
                                            {% for envvar in capability["deploymentDetails"]["environmentVariables"] %}
                                                {% set keyvalloop = loop %}
                                                    {% if is_editable %}
                                                        <input class="form-control envvar-key"
                                                               name="environmentVariables_key_{{keyvalloop.index0}}_{{ caploop }}"
                                                               placeholder="Key"
                                                               id="environmentVariables_key_{{keyvalloop.index0}}_{{ caploop }}"
                                                               type="text" value="{{ envvar | filter_nested_dict(["key"]) }}">
                                                        <input class="form-control envvar-value"
                                                               name="environmentVariables_value_{{keyvalloop.index0}}_{{ caploop }}"
                                                               placeholder="Value"
                                                               id="environmentVariables_value_{{keyvalloop.index0}}_{{ caploop }}"
                                                               type="password"
                                                               value="{{ envvar | filter_nested_dict(["value"]) }}">
                                                        <i class="bi bi-eye-slash field_icon" id="togglePassword" ></i>
                                                        <i class="bi bi-x-lg" id="env-var-close-btn"></i>
                                                    {% else %}
                                                        <input class="form-control envvar-key"
                                                               name="environmentVariables_key_{{keyvalloop.index0}}_{{ caploop }}"
                                                               placeholder="Key"
                                                               id="environmentVariables_key_{{keyvalloop.index0}}_{{ caploop }}" type="text">
                                                        <input class="form-control envvar-value"
                                                               name="environmentVariables_value_{{keyvalloop.index0}}_{{ caploop }}"
                                                               placeholder="Value"
                                                               id="environmentVariables_value_{{keyvalloop.index0}}_{{ caploop }}"
                                                               type="password">
                                                        <i class="bi bi-eye-slash field_icon" id="togglePassword"></i>
                                                        <i class="bi bi-x-lg" id="env-var-close-btn"></i>
                                                    {% endif %}
                                            {% endfor %}
                                        {%  else %}
                                            <!-- first envvar pair starts with index0 -->
                                            <input class="form-control envvar-key" name="environmentVariables_key_0_{{ loop.index0 }}" placeholder="Key"
                                                   id="environmentVariables_key_0_{{ loop.index0 }}" type="text">
                                            <input class="form-control envvar-value" name="environmentVariables_value_0_{{ loop.index0 }}" placeholder="Value"
                                                   id="environmentVariables_value_0_{{ loop.index0 }}" type="password">
                                            <i class="bi bi-eye-slash field_icon" id="togglePassword"></i>
                                            <i class="bi bi-x-lg" id="env-var-close-btn"></i>
                                        {% endif %}
                                    </div> <!-- end of div key-val_loop.index0 -->
                                </div> <!-- end of div add-env-var-div -->
                                <div id="add-env-var-div" class="row env-var-div-row">
                                    <div class="col-sm-2">
                                        <!-- empty column" -->
                                    </div>
                                    <div id="add-env-var-button-div_{{ loop.index0 }}" class="col-sm-10">
                                        <script>
                                            var env_var_button = '<button class="button button5" type="submit" id="add_env_var_{{ loop.index0 }}">' +
                                                'Add environment variables</button>'
                                            $('#add-env-var-button-div_{{ loop.index0 }}').append(env_var_button);
                                            // get all envvar pairs in the key-val div.
                                            var envvar_list = $("#key-val_{{ loop.index0 }}").children(`input[id^="environmentVariables_key_"]`);
                                            // start the envvar counter with the number of envvar pairs in the key-val div
                                            var add_env_var_button_click_count = envvar_list.length;
                                            $('#add_env_var_{{ loop.index0 }}').click(function (e) {
                                                e.preventDefault();
                                                // environment variables match the pattern environmentVariables_key_envindex_capindex
                                                $("#key-val_{{ loop.index0 }}").append("<input class=\"form-control envvar-key\" name=\"environmentVariables_key_" + add_env_var_button_click_count + "_{{ loop.index0 }}\" " +
                                                    "id=\"environmentVariables_key_" + add_env_var_button_click_count + "_{{ loop.index0 }}\" type=\"text\" placeholder=\"Key\">");
                                                $("#key-val_{{ loop.index0 }}").append("<input class=\"form-control envvar-value\" name=\"environmentVariables_value_" + add_env_var_button_click_count + "_{{ loop.index0 }}\" " +
                                                    "id=\"environmentVariables_value_" + add_env_var_button_click_count + "_{{ loop.index0 }}\" type=\"password\" placeholder=\"Value\">");
                                                $("#key-val_{{ loop.index0 }}").append($("<i class=\"bi bi-eye-slash field_icon\" id=\"togglePassword\">").on('click', function () {
                                                    $(this).toggleClass("bi-eye");
                                                    let input = $(this).prev();
                                                    if (input.attr("type") === "password") {
                                                        input.attr("type", "text");
                                                    } else {
                                                        input.attr("type", "password");
                                                    }
                                                }));
                                                var i_envvarclose = '<i class=\"bi bi-x-lg\" id=\"env-var-close-btn\"></i>';
                                                $("#key-val_{{ loop.index0 }}").append($(i_envvarclose).on('click', function () {
                                                    let closebtn = $(this);
                                                    let eyebtn = closebtn.prev();
                                                    let input_envval = eyebtn.prev();
                                                    let input_envkey = input_envval.prev();
                                                    eyebtn.remove()
                                                    input_envval.remove();
                                                    input_envkey.remove();
                                                    closebtn.remove();
                                                    MoveSelector(event);
                                                }));
                                                // once new envvar pairs are added, increment the counter
                                                add_env_var_button_click_count++;
                                            });
                                        </script>
                                    </div> <!-- end of add-env-var-button-div -->
                                </div>


                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Database Detail</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control" id="db-detail_{{loop.index0}}" name="deploymentDetails_databaseDetails_{{loop.index0}}"
                                                   placeholder="Details of API endpoint to delete user info given the user UUID"
                                                   type="text" value="{{ capability | filter_nested_dict(["deploymentDetails","databaseDetails"]) }}">
                                        {% else %}
                                            <input class="form-control" id="db-detail_{{loop.index0}}" name="deploymentDetails_databaseDetails_{{loop.index0}}"
                                                   placeholder="Details of API endpoint to delete user info given the user UUID"
                                                   type="text">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Version</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control"
                                                   id="version_{{loop.index0}}"
                                                   name="capability_version_{{loop.index0}}"
                                                   placeholder="latest version number"
                                                   type="text" value="{{ capability | filter_nested_dict(["version"]) }}">
                                        {% else %}
                                            <input class="form-control"
                                                   id="version_{{loop.index0}}"
                                                   name="capability_version_{{loop.index0}}"
                                                   placeholder="latest version number"
                                                   type="text">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2">Version URL</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control"
                                                   id="version_url_{{loop.index0}}"
                                                   name="capability_versionUrl_{{loop.index0}}"
                                                   placeholder=""
                                                   type="url" value="{{ capability | filter_nested_dict(["versionUrl"]) }}">
                                        {% else %}
                                            <input class="form-control"
                                                   id="version_url_{{loop.index0}}"
                                                   name="capability_versionUrl_{{loop.index0}}"
                                                   placeholder=""
                                                   type="url">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Health Check URL</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control"
                                                   id="health_{{loop.index0}}"
                                                   name="capability_healthCheckUrl_{{loop.index0}}"
                                                   placeholder="health check url"
                                                   type="url" value="{{ capability | filter_nested_dict(["healthCheckUrl"]) }}">
                                        {% else %}
                                            <input class="form-control"
                                                   id="health_{{loop.index0}}"
                                                   name="capability_healthCheckUrl_{{loop.index0}}"
                                                   placeholder="health check url" type="url">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Authentication Method</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control"
                                                   id="auth_{{loop.index0}}"
                                                   name="deploymentDetails_authMethod_{{loop.index0}}"
                                                   placeholder=""
                                                   type="text" value="{{ capability | filter_nested_dict(["deploymentDetails","authMethod"]) }}">
                                        {% else %}
                                            <input class="form-control"
                                                   id="auth_{{loop.index0}}"
                                                   name="deploymentDetails_authMethod_{{loop.index0}}"
                                                   placeholder="" type="text">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Data Deletion</label>
                                    <div class="col-sm-10">
                                        {% if is_editable %}
                                            <input class="form-control datadel-endpoint"
                                                   id="datadel_endpoint_{{loop.index0}}"
                                                   name="dataDeletionEndpointDetails_deletionEndpoint_{{loop.index0}}"
                                                   placeholder="Endpoint"
                                                   type="text" value="{{ capability | filter_nested_dict(["dataDeletionEndpointDetails","deletionEndpoint"]) }}">
                                        {% else %}
                                            <input class="form-control datadel-endpoint"
                                                   id="datadel_endpoint_{{loop.index0}}"
                                                   name="dataDeletionEndpointDetails_deletionEndpoint_{{loop.index0}}"
                                                   placeholder="Endpoint" type="text">
                                        {% endif %}
                                        {% if is_editable %}
                                            <input class="form-control datadel-api"
                                                   id="datadel_api_{{loop.index0}}"
                                                   name="dataDeletionEndpointDetails_apiKey_{{loop.index0}}"
                                                   placeholder="Api Key"
                                                   type="password" value="{{ capability | filter_nested_dict(["dataDeletionEndpointDetails","apiKey"]) }}">
                                            <i class="bi bi-eye-slash field_icon" id="togglePassword"></i>
                                        {% else %}
                                            <input class="form-control datadel-api"
                                                   id="datadel_api_{{loop.index0}}"
                                                   name="dataDeletionEndpointDetails_apiKey_{{loop.index0}}"
                                                   placeholder="Api Key" type="password">
                                            <i class="bi bi-eye-slash field_icon" id="togglePassword"></i>
                                        {% endif %}
                                        <br>
                                    </div>
                                </div>
                                <script>capability_count++;</script>
                            </div> <!--- end of div id capability_loop.index -->
                        </div> <!--- end of div capability-div-existing-records -->
                    {% endfor %} <!-- end of for loop iterating through existing capabilities -->
                {% endif %} <!-- end of if existing capabilities exist -->
            </div> <!-- end of div capability-parent -->
            </div> {# end of capability-parent container div #}

            <!--------------------------------------------talent block ------------------------------------------>
            <div class="container">
                <div id="talent-parent" style="display: block; background-color:white">
                <!----------------------------------------talent clean block ---------------------------------------->
                <div id="talent-div-clean" style="display: none">
                    <!-- all field id in talent clean block will be appended with _0 -->
                    <hr class="dotted">
                    <button type="button" class="button button3 pull-right delete-talent-btn" id="delete_talent" type="submit" style="margin-top:-15px;">Delete Talent</button>
                    <div id="talent">
                        <h3 id="talent">Add a Talent to this Contribution</h3>
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Talent Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="talent_name" name="talent_name"
                                       placeholder="Give a name for your talent" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Talent Description</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="talent_description" name="talent_shortDescription"
                                       placeholder="" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Required Building Block(s)</label>
                            <div class="col-sm-10">
                                <select class="custom-select" multiple id="required_bb" name="talent_requiredBuildingBlocks">
                                    {% for bb in building_blocks %}
                                        <option value='{{bb}}'>
                                            {{bb}}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Required Capabilit(y/ies)</label>
                            <div class="col-sm-10">
                                <select class="custom-select" multiple id="required_capability" name="talent_requiredCapabilities">
                                    {% for capability in required_capabilities %}
                                        <option value='{"capabilityId": "{{ capability["capabilityId"] }}",
                                                            "capabilityName": "{{ capability["capabilityName"] }}",
                                                            "contributionId": "{{ capability["contributionId"] }}"}'>
                                            {{ capability["capabilityName"] }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">User Privacy Level</label>
                            <div class="col-sm-10">
                                <input class="form-control" max="5" min="1" name="talent_minUserPrivacyLevel"
                                       step="1" type="number" value="1">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">End User Role</label>
                            <div class="col-sm-7" style="display: table">
                                <div class="form-check-label table-row-inputs">
                                    <input class="form-check-input" id="student"
                                           name="talent_minEndUserRoles"
                                           type="checkbox" value="student">
                                    <label class="checkbox-inline" for="student"> Student </label>
                                </div>
                                <div class="form-check-label table-row-inputs">
                                    <input class="form-check-input" id="visitor"
                                           name="talent_minEndUserRoles"
                                           type="checkbox" value="visitor">
                                    <label class="checkbox-inline" for="visitor"> Visitor </label>
                                </div>
                                <div class="form-check-label table-row-inputs">
                                    <input class="form-check-input" id="alumni"
                                           name="talent_minEndUserRoles"
                                           type="checkbox"
                                           value="alumni">
                                    <label class="checkbox-inline" for="alumni"> Alumni </label>
                                </div>
                                <div class="form-check-label table-row-inputs">
                                    <input class="form-check-input" id="employee"
                                           name="talent_minEndUserRoles" type="checkbox"
                                           value="employee">
                                    <label class="checkbox-inline" for="employee"> Employee </label>
                                </div>
                                <div class="form-check-label table-row-inputs">
                                    <input class="form-check-input" id="parent"
                                           name="talent_minEndUserRoles" type="checkbox"
                                           value="parent">
                                    <label class="checkbox-inline" for="parent"> Parent </label>
                                </div>
                                <div class="form-check-label table-row-inputs">
                                    <input class="form-check-input" id="fan"
                                           name="talent_minEndUserRoles"
                                           type="checkbox" value="fan">
                                    <label class="checkbox-inline" for="fan"> Fan </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-2">Select active date range</label>
                            <div class="col-sm-5" style="display: table">
                                <div class="form-check-label table-row-inputs">
                                    Start
                                    <input id="start_day" name="talent_startDate" type="date">
                                </div>
                                <div class="form-check-label table-row-inputs">
                                    End
                                    <input id="end_day" name="talent_endDate" type="date">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-sm-2">Data Description</label>
                            <div class="col-sm-10">
                                <textarea id="data_des" name="talent_dataDescription"
                                       placeholder="Detailed description of the data that is collected by this Talent, how it is used, and how this relates to the privacy level."
                                       style="height:150px"
                                       type="text">
                                </textarea>
                            </div>
                        </div>
                        <!---------- self certification block -------------------->
                        <div class="container">
                            <!--        <form class="form-horizontal" method = "POST">-->
                            <h3>Self-certification</h3>
                            <div class="form-group">
                                <label class="control-label col-sm-2">Deleting data upon request</label>
                                <div class="col-sm-10">
                                    <input class="form-control" name="selfcertificate_dataDeletionUponRequest"
                                           placeholder="Deleting data upon request" type="text">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">Respecting privacy setting</label>
                                <div class="col-sm-10">
                                    <input class="form-control" name="selfcertificate_respectingUserPrivacySetting"
                                           placeholder="Respecting privacy setting" type="text">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">Disclose sponsors / ads</label>
                                <div class="col-sm-10">
                                    <input class="form-control" name="selfcertificate_discloseAds"
                                           placeholder="Disclose sponsors / ads" type="text">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">Disclose right to use images</label>
                                <div class="col-sm-10">
                                    <input class="form-control" name="selfcertificate_discloseImageRights"
                                           placeholder="Disclose right to use images" type="text">
                                </div>
                            </div>
                        </div> <!-- end of self certification block -->
                    </div> <!-- end of div talent -->
                </div> <!-- end of talent-div-clean -->

                <!----------------------------------------talent existing record block ---------------------------------------->

                {% if post["talents"] %}
                    {% for talent in post["talents"] %}
                        <div id="talent-div-existing-records" style="display: block">
                            <hr class="dotted">
                            {% if is_editable %}
                                <button type="button" class="button button3 pull-right delete-talent-btn" id="delete_talent_{{loop.index0}}" style="margin-top:-15px;">Delete Talent</button>
                            {% endif %}
                            <div id="talent_{{loop.index0}}">
                                <h3 id="talent_{{loop.index0}}">Talent - {{ talent|filter_nested_dict(["name"]) }}</h3>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Talent Name</label>
                                    <div class="col-sm-10">
                                        <input class="form-control"
                                               id="talent_name_{{loop.index0}}"
                                               name="talent_name_{{loop.index0}}"
                                               placeholder="Give a name for your talent"
                                               type="text" value="{{ talent|filter_nested_dict(["name"]) }}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="required control-label col-sm-2">Talent Description</label>
                                    <div class="col-sm-10">
                                        <input class="form-control"
                                               id="talent_description_{{loop.index0}}"
                                               name="talent_shortDescription_{{loop.index0}}"
                                               placeholder=""
                                               type="text" value="{{ talent|filter_nested_dict(["shortDescription"]) }}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2">Required Building Block(s)</label>
                                    <div class="col-sm-10">
                                        <select class="custom-select" multiple
                                                id="required_bb_{{loop.index0}}"
                                                name="talent_requiredBuildingBlocks_{{loop.index0}}">
                                            {# if there is required building blocks in the talent #}
                                            {% if talent["requiredBuildingBlocks"] %}
                                                {% set required_bb_from_talent = talent["requiredBuildingBlocks"] %}
                                                {% for bb in building_blocks %}
                                                    {% set re_bb_ns = namespace(is_existing=false) %}
                                                    {% for rebb in required_bb_from_talent %}
                                                        {% if bb == rebb %}
                                                            {% set re_bb_ns.is_existing = True %}
                                                        {% endif %}
                                                    {% endfor %}
                                                    {% if re_bb_ns.is_existing %}
                                                        <option value='{{ bb }}' selected>
                                                            {{ bb }}
                                                        </option>
                                                    {% else %}
                                                        <option value='{{ bb }}'>
                                                            {{ bb }}
                                                        </option>
                                                    {% endif %}
                                                {% endfor %}
                                            {% else %}
                                                {# if there is no reguired building blocks #}
                                                {% for bb in building_blocks %}
                                                    <option value='{{bb}}'>
                                                        {{ bb }}
                                                    </option>
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2">Required Capabilit(y/ies)</label>
                                    <div class="col-sm-10">
                                        <select class="custom-select" multiple
                                                id="required_capability_{{loop.index0}}"
                                                name="talent_requiredCapabilities_{{loop.index0}}">
                                            {# if there is required capabilities in the talent #}
                                            {% if talent["requiredCapabilities"] %}
                                                {% set required_capabilities_from_talent = talent["requiredCapabilities"] %}
                                                {% for capability in required_capabilities %}
                                                    {% set re_cap_ns = namespace(is_existing=false) %}
                                                    {% for recap in required_capabilities_from_talent %}
                                                        {% if capability["capabilityId"] == recap["capabilityId"] %}
                                                            {% set re_cap_ns.is_existing = True %}
                                                        {% endif %}
                                                    {% endfor %}
                                                    {% if re_cap_ns.is_existing %}
                                                        <option value='{"capabilityId": "{{ capability["capabilityId"] }}",
                                                        "capabilityName": "{{ capability["capabilityName"] }}",
                                                        "contributionId": "{{ capability["contributionId"] }}"}' selected>
                                                            {{ capability["capabilityName"] }}
                                                        </option>
                                                    {% else %}
                                                        <option value='{"capabilityId": "{{ capability["capabilityId"] }}",
                                                        "capabilityName": "{{ capability["capabilityName"] }}",
                                                        "contributionId": "{{ capability["contributionId"] }}"}'>
                                                            {{ capability["capabilityName"] }}
                                                        </option>
                                                    {% endif %}
                                                {% endfor %}
                                            {% else %}
                                            {# if there is no reguired capabilities #}
                                                {% for capability in required_capabilities %}
                                                    <option value='{"capabilityId": "{{ capability["capabilityId"] }}",
                                                            "capabilityName": "{{ capability["capabilityName"] }}",
                                                            "contributionId": "{{ capability["contributionId"] }}"}'>
                                                        {{ capability["capabilityName"] }}
                                                    </option>
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2">User Privacy Level</label>
                                    <div class="col-sm-10">
                                        <input class="form-control"
                                               max="5" min="1"
                                               name="talent_minUserPrivacyLevel_{{loop.index0}}"
                                               id="minUserPrivacyLevel_{{loop.index0}}"
                                               step="1"
                                               type="number"
                                               value="{{ talent|filter_nested_dict(["minUserPrivacyLevel"]) }}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2">End User Role</label>
                                    <div class="col-sm-7" style="display: table">
                                        {% if talent["minEndUserRoles"] %}
                                            {%  set student_ns = namespace(is_on=false) %}
                                            {%  set visitor_ns = namespace(is_on=false) %}
                                            {%  set alumni_ns = namespace(is_on=false) %}
                                            {%  set employee_ns = namespace(is_on=false) %}
                                            {%  set parent_ns = namespace(is_on=false) %}
                                            {%  set fan_ns = namespace(is_on=false) %}
                                            {% for role in talent["minEndUserRoles"] %}
                                                {% if role == "student" %}
                                                    {% set student_ns.is_on = True %}
                                                {% elif role == "visitor" %}
                                                    {% set visitor_ns.is_on = True %}
                                                {% elif role == "alumni" %}
                                                    {% set alumni_ns.is_on = True %}
                                                {% elif role == "employee" %}
                                                    {% set employee_ns.is_on = True %}
                                                {% elif role == "parent" %}
                                                    {% set parent_ns.is_on = True %}
                                                {% elif role == "fan" %}
                                                    {% set fan_ns.is_on = True %}
                                                {% endif %}
                                            {% endfor %}
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="student_{{loop.index0}}"
                                                       name="talent_minEndUserRolesname_{{loop.index0}}"
                                                       type="checkbox" value="student"
                                                        {% if student_ns.is_on %} checked {% endif %}>
                                                <label class="checkbox-inline" for="student"> Student </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="visitor_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox" value="visitor"
                                                        {% if visitor_ns.is_on %} checked {% endif %}>
                                                <label class="checkbox-inline" for="visitor"> Visitor </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="alumni_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox" value="alumni"
                                                        {% if alumni_ns.is_on %} checked {% endif %}>
                                                <label class="checkbox-inline" for="alumni"> Alumni </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="employee_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox"
                                                       value="employee"
                                                        {% if employee_ns.is_on %} checked {% endif %}>
                                                <label class="checkbox-inline" for="employee"> Employee </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="parent_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox"
                                                       value="parent"
                                                        {% if parent_ns.is_on %} checked {% endif %}>
                                                <label class="checkbox-inline" for="parent"> Parent</label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="fan_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox" value="fan"
                                                        {% if fan_ns.is_on %} checked {% endif %}>
                                                <label class="checkbox-inline" for="fan"> Fan</label>
                                            </div>
                                        {% else %}
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="student_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox" value="student">
                                                <label class="checkbox-inline" for="student"> Student </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input" id="visitor_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox" value="visitor">
                                                <label class="checkbox-inline" for="visitor"> Visitor </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="alumni_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox" value="alumni">
                                                <label class="checkbox-inline" for="alumni"> Alumni </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="employee_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox"
                                                       value="employee">
                                                <label class="checkbox-inline" for="employee"> Employee </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="parent_{{loop.index0}}"
                                                       name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox"
                                                       value="parent">
                                                <label class="checkbox-inline" for="parent"> Parent </label>
                                            </div>
                                            <div class="form-check-label table-row-inputs">
                                                <input class="form-check-input"
                                                       id="fan_{{loop.index0}}" name="talent_minEndUserRoles_{{loop.index0}}"
                                                       type="checkbox" value="fan">
                                                <label class="checkbox-inline" for="fan"> Fan</label>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2">Select active date range</label>
                                    <div class="col-sm-5" style="display: table">
                                        <div class="form-check-label table-row-inputs">
                                            Start
                                            <input id="start_day_{{loop.index0}}" name="talent_startDate_{{loop.index0}}"
                                                   type="date" value="{{ talent|filter_nested_dict(["startDate"]) }}">
                                        </div>
                                        <div class="form-check-label table-row-inputs">
                                            End
                                            <input id="end_day_{{loop.index0}}" name="talent_endDate_{{loop.index0}}"
                                                   type="date" value="{{ talent|filter_nested_dict(["endDate"]) }}">
                                        </div>
                                    </div>
                                    <script>
                                        $('#start_day_{{loop.index0}}').change(function(){
                                            let start_val = $(this).val();
                                            let end_day = document.getElementById("end_day_{{loop.index0}}");
                                            end_day.setAttribute("min", start_val);
                                            let end_val = end_day.val;
                                            if (end_val < start_val){
                                                end_day.val(null);
                                            }
                                        });
                                    </script>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2">Data Description</label>
                                    <div class="col-sm-10">
                                        <textarea id="data_des_{{loop.index0}}"
                                               name="talent_dataDescription_{{loop.index0}}"
                                               placeholder="Detailed description of the data that is collected by this Talent, how it is used, and how this relates to the privacy level."
                                               style="height:150px"
                                               type="text"
                                               value="{{ talent|filter_nested_dict(["dataDescription"]) }}">
                                        </textarea>
                                    </div>
                                </div>
                                <!---------- self certification block -------------------->
                                <div class="container">
                                    <h3>Self-certification</h3>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Deleting data upon request</label>
                                        <div class="col-sm-10">
                                            <input class="form-control"
                                                   id="dataDeletionUponRequest_{{loop.index0}}"
                                                   name="selfcertificate_dataDeletionUponRequest_{{loop.index0}}"
                                                   placeholder="Deleting data upon request"
                                                   type="text"
                                                   value="{{ talent|filter_nested_dict(["selfCertification", "dataDeletionUponRequest"]) }}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Respecting privacy setting</label>
                                        <div class="col-sm-10">
                                            <input class="form-control"
                                                   id="respectingUserPrivacySetting_{{loop.index0}}"
                                                   name="selfcertificate_respectingUserPrivacySetting_{{loop.index0}}"
                                                   placeholder="Respecting privacy setting"
                                                   type="text"
                                                   value="{{ talent|filter_nested_dict(["selfCertification", "respectingUserPrivacySetting"]) }}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Disclose sponsors / ads</label>
                                        <div class="col-sm-10">
                                            <input class="form-control"
                                                   id="discloseAds_{{loop.index0}}"
                                                   name="selfcertificate_discloseAds_{{loop.index0}}"
                                                   placeholder="Disclose sponsors / ads"
                                                   type="text"
                                                   value="{{ talent|filter_nested_dict(["selfCertification", "discloseAds"]) }}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-2">Disclose right to use images</label>
                                        <div class="col-sm-10">
                                            <input class="form-control"
                                                   id="discloseImageRights_{{loop.index0}}"
                                                   name="selfcertificate_discloseImageRights_{{loop.index0}}"
                                                   placeholder="Disclose right to use images"
                                                   type="text"
                                                   value="{{ talent|filter_nested_dict(["selfCertification", "discloseImageRights"]) }}">
                                        </div>
                                    </div>
                                </div> <!-- end of self certification block div -->
                                <script>talent_count++;</script>
                            </div>  <!--- end of div id talent_loop.index -->
                        <!-- end of existing talent_i -->
                        </div> <!-- end of talent-div-existing-records -->
                    {% endfor %} <!-- end of for loop iterating through existing talents -->
                {% endif %}  <!-- end of if existing talents exist -->
            </div>  <!-- end of div talent-parent -->
            </div> {# end of talent-parent container div #}

            <div class="container">
                <div id="select-contribution-div-placeholder" class="row" style="margin-bottom:1cm">
                    <!-- place holder for dynamic add capability / talent buttons" -->
                </div> {# end of place holder for dynamic add capability / talent buttons container div #}
            </div>

            <!--------------------------------------------contact/privacy check ------------------------------------------>
            <div id="cd-multi-steps-text-bottom" class="container">
                <nav>
                    <ol class="cd-multi-steps text-top">
                        <li class="visited"><a href="#contribute">Contribution Details</a></li>
                        <li class="visited"><em><a href="#capability-parent">Capability / Talent Details </a></em></li>
                        <li class="current"><em><a href="#contact">Contact Details</a></em></li>
                        <li><em><a href="#submit">Submit</a></em></li>
                    </ol>
                </nav>
            </div>

            <div class="container">
                <h3 id="contact">Contact Details</h3>
                {% if post.contacts %}
                    {% set contact = post["contacts"][0] %}
                    {% if is_editable %}
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Contact Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_name" name="contact_name"
                                       placeholder="" type="text" value="{{ contact.name }}">
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Contact Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_name" name="contact_name"
                                       placeholder="" type="text">
                            </div>
                        </div>
                    {% endif %}
                    {% if is_editable %}
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Contact Email</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_email" name="contact_email"
                                       placeholder="" type="email" value="{{ contact.email }}">
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Contact Email</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_email" name="contact_email"
                                       placeholder="" type="email">
                            </div>
                        </div>
                    {% endif %}
                    {% if is_editable %}
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Contact Phone</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_phone"
                                       name="contact_phone" placeholder="" type="tel"
                                       value="{{ contact.phone }}" minlength="9" maxlength="14"/>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="required control-label col-sm-2">Contact Phone</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_phone" name="contact_phone"
                                       placeholder="" type="tel" minlength="9" maxlength="14"/>
                            </div>
                        </div>
                    {% endif %}
                    {% if is_editable %}
                        <div class="form-group">
                            <label class="control-label col-sm-2">Contact Organization</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_org"
                                       name="contact_organization" placeholder="" type="text"
                                       value="{{ contact.organization }}">
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="control-label col-sm-2">Contact Organization</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_org"
                                       name="contact_organization" placeholder="" type="text">
                            </div>
                        </div>
                    {% endif %}
                    {% if is_editable %}
                        <div class="form-group">
                            <label class="control-label col-sm-2">Official Address</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_address"
                                       name="contact_officialAddress" placeholder="" type="text"
                                       value="{{ contact.officialAddress }}">
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="control-label col-sm-2">Official Address</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="contact_address"
                                       name="contact_officialAddress" placeholder="" type="text">
                            </div>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="form-group">
                        <label class="required control-label col-sm-2">Contact Name</label>
                        <div class="col-sm-10">
                            <input class="form-control" id="contact_name" name="contact_name"
                                   placeholder="" type="text">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="required control-label col-sm-2">Contact Email</label>
                        <div class="col-sm-10">
                            <input class="form-control" id="contact_email" name="contact_email" placeholder="" type="email">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="required control-label col-sm-2">Contact Phone</label>
                        <div class="col-sm-10">
                            <input class="form-control" id="contact_phone" name="contact_phone"
                                   placeholder="" type="tel" minlength="9" maxlength="14" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">Contact Organization</label>
                        <div class="col-sm-10">
                            <input class="form-control" id="contact_org" name="contact_organization"
                                   placeholder="" type="text">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">Official Address</label>
                        <div class="col-sm-10">
                            <input class="form-control" id="contact_address" name="contact_officialAddress"
                                   placeholder="" type="text">
                        </div>
                    </div>
                {% endif %}
            </div> <!-- end of class container Contact Details div -->

            <!-------------------------------------------- submit ------------------------------------------>
            <div class="container" id="submit">
                <div class="row">
                    <button type="button" class="button button2" id="cancel_button" data-toggle="modal" data-target="#cancel-modal">Cancel </button>
                    <input href="{{ url_for('contribute.home') }}" id="submit_button" class="button button3"
                           onsubmit="return data_validation()" type="submit" value="Submit">
                </div>
            </div>

            <!-- Submit modal -->
            <div class="modal" id="submit-modal">
                <!-- Modal content -->
                <div class="modal-content">
                    <div class="modal-body">
                        <span class="close"><i class="bi bi-x-lg" id="close-btn"></i></span>
                        <p id="submit-pop" >Please finish the form!</p>
                    </div>
                </div>
            </div>

            <!-- Cancel Confirmation modal -->
            <div class="modal" id="cancel-modal" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="cancel-modal-title" id="cancel-modal-title" style="display: inline-block">
                              Cancel submission
                            </h3>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <i class="bi bi-x-lg" id="close-btn"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <h5>Are you sure you want to Cancel this submission?</h5>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="button button2" data-dismiss="modal">No</button>
                            <a class="button button3" role="button" id="cancel-modal-btn-yes" href="{{ url_for('contribute.home') }}" style="text-decoration: none">
                                Yes
                            </a>
                        </div>
                    </div>
                </div>
            </div> <!-- end of cancel-modal div -->

        </form> <!-- end of form -->
    </div> <!-- end -->

{% include 'footer.html' %}
{% include 'topnav_javascript.html' %}
</body>

<script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@9.0.0/dist/js/autoComplete.min.js"></script>
<script>
    // toggle sensitive data visibility
    $('.bi').each(function () {
        let eye = $(this);
        eye.on('click', function() {
            let icon = $(this);
            icon.toggleClass("bi-eye");
            let input = icon.prev("input")
            input.each(function () {
                if (icon.hasClass('bi-eye')) {
                    input.attr('type', 'text');
                }
                else if (icon.hasClass('bi-eye-slash')) {
                    input.attr('type', 'password');
                }
            });
        });
    });

    // validate start and end dates in talent form
    $('[id^="start_day"]').change(function() {
        let start_day_id = this.id;
        let id_number = start_day_id.replace("start_day_", "");
        let start_val = $(this).val();
        let end_day = document.getElementById("end_day_" + id_number);
        end_day.setAttribute("min", start_val);
        let end_val = end_day.val;
        if (end_val < start_val) {
            end_day.val(null)
        }
    });

    // delete environment keyvalue pair
    $('[id="env-var-close-btn"]').on('click', function () {
        let closebtn = $(this);
        let eyebtn = closebtn.prev();
        let input_envval = eyebtn.prev();
        let input_envkey = input_envval.prev();
        eyebtn.remove()
        input_envval.remove();
        input_envkey.remove();
        closebtn.remove();
        // adjust selector button div
        MoveSelector(event);
    });

    // IsOpenSourceUrl radio button
    $(function(event) {
        $('input[name^="capability_isOpenSource"]').on('click', function() {
           // get the capability number and show/hide sourceurl
           var isopensource_id = $(this).attr("id");
           let cap_num = isopensource_id.split("_").pop();
           if ($(this).val() == 'y') {
               $('#sourceurl_' + cap_num).show();
               // adjust selector button position
               MoveSelector(event);
           }
           else {
               $('#sourceurl_' + cap_num).hide();
           }
        });

    });

    $(function () {
        function split(val) {
            return val.split(/,\s*/);
        }

        function extractLast(term) {
            return split(term).pop();
        }

        $("#contribution_Admins")
            .on("keydown", function (event) {
                if (event.keyCode === $.ui.keyCode.TAB &&
                    $(this).autocomplete("instance").menu.active) {
                    event.preventDefault();
                }
            })
            .autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "https://api.github.com/search/users",
                        data: {
                            q: extractLast(request.term)
                        },
                        type: "GET",
                        headers: {Authorization: 'token ' + '{{token}}'},
                        success: function (data) {
                            var res = [];
                            data.items.forEach((e) => res.push(e.login));
                            response(res);
                        }
                    })
                },
                search: function () {
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false;
                    }
                },
                focus: function () {
                    // prevent value inserted on focus
                    return false;
                },
                select: function (event, ui) {
                    var terms = split(this.value);
                    // remove the current input
                    terms.pop();
                    // add the selected item
                    terms.push(ui.item.value);
                    // add placeholder to get the comma-and-space at the end
                    terms.push("");
                    this.value = terms.join(", ");
                    return false;
                }
            });
    });

    var modal = document.getElementById("submit-modal");
    // Get the button that opens the modal
    var btn = document.getElementById("submit_button");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function () {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function data_validation() {
        var contribution_name = document.getElementById('contribution_name');
        if (contribution_name.value == "") {
            // window.alert("Please enter the contribution name.");
            contribution_name.focus();
            var x = document.getElementById("contribution_name_div");
            // x.querySelector(".error_message").innerHTML = "This is required!";
            contribution_name.required = true;
            return false;
        }
        var contribution_des = document.getElementById('contribution_description');
        if (contribution_des.value == "") {
            // window.alert("Please enter the contribution description.");
            contribution_des.focus();
            contribution_des.required = true;
            return false;
        }
        if (capability_count == 0 && talent_count == 0) {
            document.getElementById('select-contribution').focus();
            document.getElementById('select-contribution').required = true;
            window.alert("Please enter either a capability or a talent.");
            return false;
        }
        var capability_name = []
        var capability_description = []
        var capability_opensource = []
        var opensource_yes = []
        var opensource_no = []
        var deploy_location = []
        var deploy_internal = []
        var deploy_external = []
        var environmentVariables_key = []
        var environmentVariables_value = []
        var dockerimage = []
        var db = []
        var version = []
        var health_check = []
        var authmethod = []
        var datadel_endpoint = []
        var datadel_api = []

        if (capability_count > 0) {
            // validation for empty environmentVariable key
            environmentVariables_keys_list = document.getElementsByClassName("envvar-key");
            // start from index1. index0 is input#environmentVariables_key_0 which does not have any value
            for (var envkey_ind=1; envkey_ind<environmentVariables_keys_list.length; envkey_ind++)
            {
                if (environmentVariables_keys_list[envkey_ind].value == "") {
                    environmentVariables_keys_list[envkey_ind].focus();
                    environmentVariables_keys_list[envkey_ind].required = true;
                    return false;
                }
            }

            // get the _num of capabilities and iterate through the list
            var div_cap_ids = $("div[id^='capability_']").map(function() {
                                return this.id;
                                }).get();
            for (var ind = 0; ind < div_cap_ids.length; ind++) {
                let i = div_cap_ids[ind].split("_").pop();
                capability_name[i] = document.getElementById('capability_name' + '_' + i);
                if (capability_name[i].value == "") {
                    // window.alert("Please enter either a capability description.");
                    capability_name[i].focus();
                    capability_name[i].required = true;
                    return false;
                }
                capability_description[i] = document.getElementById('capability_description' + '_' + i);
                if (capability_description[i].value == "") {
                    // window.alert("Please enter either a capability description.");
                    capability_description[i].focus();
                    capability_description[i].required = true;
                    return false;
                }
                opensource_yes[i] = document.getElementById('open_source_yes' + '_' + i);
                opensource_no[i] = document.getElementById('open_source_no' + '_' + i);
                if (!opensource_yes[i].checked && !opensource_no[i].checked) {
                    window.alert("Please enter if this capability is open-sourced.");
                    opensource_yes[i].focus();
                    return false;
                }
                deploy_location[i] = document.getElementsByName('deploymentDetails_location' + '_' + i)
                deploy_internal[i] = document.getElementById('deploy_internal' + '_' + i)
                deploy_external[i] = document.getElementById('deploy_external' + '_' + i)
                if (!deploy_internal[i].checked && !deploy_external[i].checked) {
                    window.alert("Please select deployed location.");
                    deploy_internal[i].focus();
                    return false;
                }
                dockerimage[i] = document.getElementById('docker_img' + '_' + i);
                if (dockerimage[i].value == "") {
                    // window.alert("Please enter the docker image.");
                    dockerimage[i].focus();
                    dockerimage[i].required = true;
                    return false;
                }
                db[i] = document.getElementById('db-detail' + '_' + i);
                if (db[i].value == "") {
                    // window.alert("Please enter the database details. ");
                    db[i].focus();
                    db[i].required = true;
                    return false;
                }
                version[i] = document.getElementById('version' + '_' + i);
                if (version[i].value == "") {
                    // window.alert("Please enter the version. ");
                    version[i].focus();
                    version[i].required = true;
                    return false;
                }
                health_check[i] = document.getElementById('health' + '_' + i);
                if (health_check[i].value == "") {
                    // window.alert("Please enter the health check url. ");
                    health_check[i].focus();
                    health_check[i].required = true;
                    return false;
                }
                authmethod[i] = document.getElementById('auth' + '_' + i);
                if (authmethod[i].value == "") {
                    // window.alert("Please enter the auth method. ");
                    authmethod[i].focus();
                    authmethod[i].required = true;
                    return false;
                }
                datadel_endpoint[i] = document.getElementById("datadel_endpoint" + '_' + i);
                if (datadel_endpoint[i].value == "") {
                    // window.alert("Please enter the data deletion endpoint. ");
                    datadel_endpoint[i].focus();
                    datadel_endpoint[i].required = true;
                    return false;
                }
                datadel_api[i] = document.getElementById("datadel_api" + '_' + i);
                if (datadel_api[i].value == "") {
                    // window.alert("Please enter the data deletion api. ");
                    datadel_api[i].focus();
                    datadel_api[i].required = true;
                    return false;
                }
            }
        }
        var talent_name = []
        var talent_des = []
        if (talent_count > 0) {
            // get the _num of talents and iterate through the list
            var div_talent_ids = $("div[id^='talent_']").map(function() {
                return this.id;
            }).get();
            for (var ind = 0; ind < div_talent_ids.length; ind++) {
                let i = div_talent_ids[ind].split("_").pop();
                talent_name[i] = document.getElementById('talent_name_' + i);
                if (talent_name[i].value == "") {
                    talent_name[i].focus();
                    talent_name[i].required = true;
                    return false;
                }
                talent_des[i] = document.getElementById("talent_description_" + i);
                if (talent_des[i].value == "") {
                    // window.alert("Please enter the talent description. ");
                    talent_des[i].focus();
                    talent_des[i].required = true;
                    return false;
                }
            }
        }
        var contact_name = document.getElementById('contact_name');
        if (contact_name.value == "") {
            contact_name.focus();
            var x = document.getElementById("contribution_name_div");
            // x.querySelector(".error_message").innerHTML = "This is required!";
            contact_name.required = true;
            return false;
        }
        var contact_email = document.getElementById('contact_email');
        if (contact_email.value == "") {
            contact_email.focus();
            contact_email.required = true;
            return false;
        }
        var contact_phone = document.getElementById('contact_phone');
        if (contact_phone.value == "") {
            contact_phone.focus();
            contact_phone.required = true;
            return false;
        }
        //success
        // window.location.href = "/contribute";
        var x = document.getElementById('submit-pop').innerHTML = "Your Contribution is being submitted. Please wait!";
    }

    function show_person() {
        var x = document.getElementById("contributor");
        if (x.style.display === "none") {
            x.style.display = "block";
        }

        var y = document.getElementById("add-contributor-person");
        if (y.style.display === "none") {
            y.style.display = "block";
        } else {
            y.style.display = "none";
        }
    }

    function show_org() {
        var x = document.getElementById("organization");
        if (x.style.display === "none") {
            x.style.display = "block";
        }
        var a = document.getElementById("contributor");
        if (a.style.display === "block") {
            a.style.display = "none";
        }
    }
    // not currently used
    function duplicate() {
        var original = document.getElementById('capability' + i);
        var clone = original.cloneNode(true); // "deep" clone
        clone.id = "capability" + ++i; // there can only be one element with an ID
        clone.onclick = duplicate; // event handlers are not cloned
        original.parentNode.appendChild(clone);
    }

    // delete capability
    $('.delete-capability-btn').on('click', function (e) {
        e.preventDefault();
        // get the capability number and remove all corresponding divs
        var del_cap_button_id = $(this).attr("id");
        let cap_num = del_cap_button_id.split("_").pop();
        $("#capability_" + cap_num).remove();
        $(this).hide();
        // remove hr dotted line
        let hr_dot = $(this).prev("hr");
        hr_dot.remove();
        capability_count--;
        // adjust selector div position
        MoveSelector(e);
    });

    function AddCapability(event) {
        event.preventDefault();
        var $clone = $("#capability-div-clean").clone(true);
        $clone.find(':input').attr('id', function (i, val) {
            return val + '_' + capability_count;
        });
        $clone.find(':input').attr('name', function (i, val) {
            return val + '_' + capability_count;
        });
        $clone.find('div').attr('id', function (i, val) {
            return val + '_' + capability_count;
        });
        $clone.attr('style', 'display: block, background-color: white')

        var i = capability_count;
        var env_var_button = '<button class="button button5" type="submit" id="add_env_var_' + i + '">' +
            'Add environment variables</button>'

        $("#capability-parent").append($clone);
        $("#capability-parent").append("<br>");

        // adjust selector button position
        MoveSelector(event);

        $('#add-env-var-button-div_' + i).append(env_var_button);
        // get all envvar pairs in the corresponding key-val div
        let $key_val_div = $("#key-val_" + i)
        var envvar_list = $key_val_div.children(`input[id^="environmentVariables_key_"]`);
        // when adding more envvars start the counter with the number of envvar pairs already present.
        var add_env_var_button_click_count = envvar_list.length;
        $('#add_env_var_' + i).click(function (e) {
            e.preventDefault();

            $key_val_div.append("<input class = \"form-control envvar-key\" name=\"environmentVariables_key_" + add_env_var_button_click_count + "_" + i + "\" " +
                "id=\"environmentVariables_key_" + add_env_var_button_click_count + "_" + i + "\" type=\"text\" placeholder=\"Key\">");
            $key_val_div.append("<input class = \"form-control envvar-value\" name=\"environmentVariables_value_" + add_env_var_button_click_count + "_" + i + "\" " +
                "id=\"environmentVariables_value_" + add_env_var_button_click_count + "_" + i + "\" type=\"password\" placeholder=\"Value\">");
            $key_val_div.append($("<i class=\"bi bi-eye-slash field_icon\" id=\"togglePassword\" >").on('click', function () {
                $(this).toggleClass("bi-eye");
                let input = $(this).prev();
                if (input.attr("type") === "password") {
                    input.attr("type", "text");
                } else {
                    input.attr("type", "password");
                }
            }));
            var i_envvarclose = '<i class=\"bi bi-x-lg\" id=\"env-var-close-btn\"></i>';
            $key_val_div.append($(i_envvarclose).on('click', function () {
                let closebtn = $(this);
                let eyebtn = closebtn.prev();
                let input_envval = eyebtn.prev();
                let input_envkey = input_envval.prev();
                eyebtn.remove()
                input_envval.remove();
                input_envkey.remove();
                closebtn.remove();
                // adjust selector buttons
                MoveSelector(event);
            }));
            // once new envvar pairs are added, increment the envvar counter
            add_env_var_button_click_count++;

            // adjust button position
            MoveSelector(event);
        });

        if ($('input[id=\"open_source_yes_' + i + '\"]').is(':checked')) {
            $('#sourceurl_' + i).show();
        } else {
            $('#sourceurl_' + i).hide();
        }

        capability_count++;

    }

    function MoveSelector(event) {
        // adjust button position
        event.preventDefault();
        $('#select-contribution-div').position({
            my: "bottom",
            at: "top",
            of: $("#cd-multi-steps-text-bottom"),
            collision: "none none"
        });
    }

    function AddTalent(event) {
        event.preventDefault();
        var $clone = $("#talent-div-clean").clone(true);
        $clone.find(':input').attr('id', function (i, val) {
            return val + '_' + talent_count;
        });
        $clone.find(':input').attr('name', function (i, val) {
            return val + '_' + talent_count;
        });
        $clone.find('div').attr('id', function (i, val) {
            return val + '_' + talent_count;
        });
        $clone.attr('style', 'display: block, background-color: white')

        var i = talent_count;

        $("#talent-parent").append($clone);
        $("#talent-parent").append("<br>");

        talent_count++;

    }

    // delete talent
    $('.delete-talent-btn').on('click', function (e) {
        e.preventDefault();
        // get the talent number and remove all corresponding divs
        let del_tal_button_id = $(this).attr("id");
        let tal_num = del_tal_button_id.split("_").pop();
        $("#talent_" + tal_num).remove();
        $(this).hide();
        // remove hr dotted line
        let hr_dot = $(this).prev("hr");
        hr_dot.remove();
        talent_count--;
        // adjust selector div position
        MoveSelector(e);
    });

    $(function () {
        $("#add-contributor-person").click(function (e) {
            e.preventDefault();
            var $clone = $("#person-clean").clone(true);
            $clone.find(':input').attr('id', function (i, val) {
                return val + '_' + contributor_count;
            });
            $clone.find(':input').attr('name', function (i, val) {
                return val + '_' + contributor_count;
            });
            $clone.attr('style', 'display: block, background-color: white')

            $("#contributor-parent").append($clone);
            $("#contributor-parent").append("<br>");

            contributor_count++;
        });
    });

    $(function () {
        $("#add-contributor-org").click(function (e) {
            e.preventDefault();
            var $clone = $("#organization-clean").clone(true);
            $clone.find(':input').attr('id', function (i, val) {
                return val + '_' + contributor_count;
            });
            $clone.find(':input').attr('name', function (i, val) {
                return val + '_' + contributor_count;
            });
            $clone.attr('style', 'display: block, background-color: white')

            $("#contributor-parent").append($clone);
            $("#contributor-parent").append("<br>");

            contributor_count++;
        });
    });

    var user_icon = document.getElementById('user_profile');
    user_icon.onclick = function () {
        document.getElementById("myDropdown").classList.toggle("show");
    }

    window.onclick = function (event) {
        if (!event.target.matches('.dropbtn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            for (let i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }

</script>
</html>
